<%- partial('_partial/header') %>
<% var i; %>
  <article itemscope itemtype="https://schema.org/Recipe">

    <section class="section1" id="principi">

      <h1><div class="sub"><span>Le 3 cose da sapere per fare <%- page.titleArticle %></span></div><span itemprop="name"><%- page.title.toLowerCase() %></span></h1>

      <div class="card-list">
      <% for ( i = 0; i < page.principles.length; i++ ) { %>
        <div>
          <div class="card" itemprop="description">
            <p><%- page.principles[ i ] %></p>
          </div>
        </div>
      <% } %>
        <div><%
        if ( page.timeToMake ) { %>
          <div class="card-time">
            <p>Si può fare in<br/><strong><%- page.timeToMake %></strong></p>
          </div><%
        } %>
        </div>

        <div><%
        if ( page.timeToUse ) { %>
          <div class="card-time">
            <p>Si può <% if ( page.category === 'hygiene' ) { %>usare<% } else { %>consumare<% } %> dopo<br/><strong><%- page.timeToUse %></strong></p>
          </div><%
        } %>
        </div>

        <div><%
        if ( page.sources ) { %>
          <div class="card-empty">
            <h5>Fonti</h5>
            <ul><%
            for ( i = 0; i < page.sources.length; i++ ) { %>
              <li><%- page.sources[ i ] %></li><%
            } %>
            </ul>
          </div><%
        } %>
        </div>

      </div>

    </section>

    <section class="section2" id="ingredienti">

      <h2>Ingredienti
        <div class="sub">
          <span><%- page.recipeIntro[ 0 ] %></span>
          <span class="quantity">
            <button class="btn" id="qtyRemove"><span>–</span></button><span id="qtyValue"><%- page.recipeBase.qty %></span><% if ( page.recipeBase.units ) { %> <%- page.recipeBase.units %><% } %><button class="btn" id="qtyAdd"><span>+</span></button>
          </span>
          <span><%- page.recipeIntro[ 1 ] %></span>
        </div>
      </h2>

      <div class="card-list">
      <%

        var ingr = {},
          recipeBaseRatio = 1;

        if ( page.recipeBase.units === 'ml' && page.ingredients[ 0 ].units !== 'ml' ) {
          var ingrSpecRatios = 0;
          for ( i in page.ingredients ) {
            if ( page.ingredients[ i ].spec ) {
              ingrSpecRatios += +page.ingredients[ i ].ratio / +page.ingredients[ i ].spec;
            }
          }
          recipeBaseRatio = Math.round( ( 1 / ingrSpecRatios ) * 100000 ) / 1000;
        }

        for ( i = 0; i < page.ingredients.length; i++ ) {

          if ( page.ingredients[ i ].ratio ) {
            ingr[ page.ingredients[ i ].id ] = {
              ratio: +page.ingredients[ i ].ratio,
              spec: +page.ingredients[ i ].spec,
              units: page.ingredients[ i ].units
            };
          }

          if ( page.ingredients[ i ].name ) {

      %>
        <div>
          <div class="card">
            <h3 itemprop="recipeIngredient"><span class="ingredient"><%- page.ingredients[ i ].name %></span><% if ( page.ingredients[ i ].qty ) { %><br/><span class="quantity"><span data-qty="<%- page.ingredients[ i ].id %>"><%- page.ingredients[ i ].qty %></span> <%- page.ingredients[ i ].units %></span><% } %></h3>
            <% if ( page.ingredients[ i ].notes ) { %><p class="note"><%- page.ingredients[ i ].notes %></p><% } %>
          </div>
        </div><%
          }
        }
        if ( page.recipeDisclaimer ) { %>
        <div>
          <div class="card-empty">
            <p><%- page.recipeDisclaimer %></p>
          </div>
        </div>
      <% } %>
        <script>var recipeBase=<%- JSON.stringify( page.recipeBase ) %>,recipeBaseRatio=<%- recipeBaseRatio %>,<% if ( page.recipeRange ) { %>recipeRange=[<%- page.recipeRange %>],<% } %><% if ( page.recipePrecision ) { %>recipePrecision=[<%- page.recipePrecision %>],<% } %>ingredients=<%- JSON.stringify( ingr ) %></script>
      </div>

    </section>

    <section class="section3" id="attrezzatura">

      <h2>Attrezzatura</h2>

      <div class="card-list">
      <% for ( i = 0; i < page.tools.length; i++ ) { %>
        <div>
          <div class="card">
            <h3 itemprop="tool"><%- page.tools[ i ][ 0 ] %></h3>
            <% if ( page.tools[ i ][ 1 ] ) { %><p class="note"><%- page.tools[ i ][ 1 ] %></p><% } %>
          </div>
        </div>
      <% } %>
      </div>

    </section>

    <section class="section4 section-instructions" id="ricetta">

      <h2><div class="sub"><span>Ricetta passo passo</span></div>Come fare <%- page.titleArticle %> <%- page.title.toLowerCase() %></h2>

      <div class="card-list card-list-ordered">
      <% for ( i = 0; i < page.directions.length; i++ ) { %>
        <div>
          <div class="card<% if ( page.directions[ i ][ 2 ] ) { %> card-title<% } %>" itemprop="recipeInstructions"><%
            if ( page.directions[ i ][ 2 ] ) { %>
              <h3><%- page.directions[ i ][ 2 ] %></h3><%
            } %>
            <p><%- page.directions[ i ][ 0 ] %></p>
            <% if ( page.directions[ i ][ 1 ] ) { %><p class="note"><%- page.directions[ i ][ 1 ] %></p><% } %>
          </div>
        </div>
      <% } %>
      </div>

    </section>

    <section class="section5" id="uso">

      <h2>Uso e conservazione</h2>

      <div class="card-list">
      <% for ( i = 0; i < page.usage.length; i++ ) { %>
        <div>
          <div class="card">
            <p><%- page.usage[ i ][ 0 ] %></p>
            <% if ( page.usage[ i ][ 1 ] ) { %><p class="note"><%- page.usage[ i ][ 1 ] %></p><% } %>
          </div>
        </div>
      <% } %>
      </div>

    </section>

    <div class="article-actions">
      <div class="btns-list">
        <a href="/" class="btn btn-main">\ <span class="mobilehide">Tutte le </span>ricette</a>
      </div>
      <div class="btns-list mobilehide">
        <button class="btn btn-main hidden" id="btn-prev"><span>&lt;</span></button>
        <button class="btn btn-main hidden" id="btn-next"><span>Continua &gt;</span></button>
      </div>
    </div>

  </article>

  <script type="application/ld+json">
    {
      "@context": "https://schema.org/",
      "@type": "Recipe",
      "name": "<%- page.title %>",
      "image": "<%- config.url %>/recipes/images/<%- page.recipeid %>.png",
      "author": {
        "@type": "Organization",
        "name": "simpletomake.it"
      },
      "description": "<% for ( i = 0; i < page.principles.length; i++ ) { %><%- page.principles[ i ] %>. <% } %>",
      "recipeIngredient": [<% for ( i = 0; i < page.ingredients.length; i++ ) { if ( page.ingredients[ i ].name ) {  %>
        "<% if ( page.ingredients[ i ].qty ) { %><%- page.ingredients[ i ].qty %> <%- page.ingredients[ i ].units %> <% } %><%- page.ingredients[ i ].name %>"<% if ( i < page.ingredients.length - 1 ) { %>, <% } %><% } %><% } %>
      ],
      "recipeInstructions": [<% for ( i = 0; i < page.directions.length; i++ ) { %>
        {
          "@type": "HowToStep",
          "text": "<%- page.directions[ i ] %>"
        }<% if ( i < page.directions.length - 1 ) { %>, <% } %><% } %>
      ]
    }
    </script>

<%- partial('_partial/footer') %>