<% var i, j; %>

  <a name="top"></a>

  <div class="recipeheader">

    <div class="nav-main-wrapper">
      <nav class="nav-main">
        <%- partial('_partial/nav-main') %>
      </nav>
    </div>

    <a href="/" class="breadcrumb"><strong>Simple To Make It</strong></a>

    <div class="content">

      <div class="recipeheader-main">
        <h1><div class="sub"><span>Ricetta</span></div>Come fare <%- page.titleArticle %> <%- page.title.toLowerCase().replace( '(', '<div class="sub"><span>– ' ).replace( ')', '</span></div>' ) %></h1>
        <h5>Le 3 cose da sapere</h5>
        <ol>
        <% for ( i = 0; i < page.principles.length; i++ ) { %>
          <li><%- page.principles[ i ] %></li>
        <% } %>
        </ol>
      </div>

      <% if ( page.posterimage ) { %>
      <div class="recipeheader-image">
        <img src="/recipes/covers/<%= page.posterimage %>.jpg" alt="<%= page.title %>">
      </div>
      <% } %>

      <div class="recipeheader-meta">
        <svg class="icon"><use xlink:href="/images/svgdefs.svg#icon-clock"/></svg><%
      if ( page.timeToMake ) { %>
        <div>
          <h6>Si può fare in</h6>
          <span><%- page.timeToMake %></span>
        </div><%
      }
      if ( page.timeToUse ) { %>
        <div>
          <h6>Si può <% if ( page.category === 'hygiene' ) { %>usare<% } else { %>consumare<% } %> dopo</h6>
          <span><%- page.timeToUse %></span>
        </div><%
      } %>
      </div>

    </div>

  </div>

  <article>

    <section class="content section1">

      <div class="cols cols-1-2">

        <div class="sources"><%
        if ( page.sources ) { %>
          <div class="card-empty">
            <h5>Riferimenti</h5>
            <ul><%
            for ( i = 0; i < page.sources.length; i++ ) { %>
              <li><svg class="icon"><use xlink:href="/images/svgdefs.svg#icon-<%= page.sources[ i ][ 0 ] %>"/></svg><span><%- page.sources[ i ][ 1 ] %></span></li><%
            } %>
            </ul>
          </div><%
        } %>
        </div>

        <div>
          <div class="card-empty"><%
          if ( page.comparisonIngredients || page.comparisonPrices ) { %>
            <h5>Rispetto ad un prodotto industriale</h5><%
          } %>
            <div class="comparison"><%
            if ( page.comparisonIngredients ) { %>
              <div>
                <h6>Ingredienti</h6>
                <div class="comparison-row">
                  <% for ( j = 0; j < page.comparisonIngredients[ 0 ].length; j++ ) { %><ul><% for ( i = 0; i < (j > 0? page.comparisonIngredients[ 0 ][ j ]-page.comparisonIngredients[ 0 ][ j-1 ] : page.comparisonIngredients[ 0 ][ j ]); i++ ) { %><li></li><% } %></ul><% } %>
                </div>
                <span>anziché</span>
                <div class="comparison-row">
                  <% for ( j = 0; j < page.comparisonIngredients[ 1 ].length; j++ ) { %><ul><% for ( i = 0; i < (j > 0? page.comparisonIngredients[ 1 ][ j ]-page.comparisonIngredients[ 1 ][ j-1 ] : page.comparisonIngredients[ 1 ][ j ]); i++ ) { %><li></li><% } %></ul><% } %>
                </div>
              </div><%
            }
            if ( page.comparisonPrices ) {
              var cPriceMax1 = +page.comparisonPrices[ 1 ][ 1 ],
                cPriceMin1 = Math.round( page.comparisonPrices[ 1 ][ 0 ] / cPriceMax1 * 100 ),
                cPriceMin0 = Math.round( page.comparisonPrices[ 0 ][ 0 ] / cPriceMax1 * 100 ),
                cPriceMax0 = Math.round( page.comparisonPrices[ 0 ][ 1 ] / cPriceMax1 * 100 ); %>
              <div>
                <h6>Costo <%- page.comparisonPricesQty %></h6>
                <div class="comparison-row">
                  <h6>€ <%- page.comparisonPrices[ 0 ].join(' - ') %></strong></h6>
                  <div class="bar" style="width:<%- cPriceMax0 %>%"></div><div class="bar" style="width:<%- cPriceMin0 %>%"></div>
                </div>
                <span>anziché</span>
                <div class="comparison-row">
                  <h6>€ <%- page.comparisonPrices[ 1 ].join(' - ') %></h6>
                  <div class="bar" style="width:100%"></div><div class="bar" style="width:<%- cPriceMin1 %>%"></div>
                </div>
              </div><%
            } %>
            </div>
          </div>
        </div>

      </div>

    </section>

    <section class="content section2 section-ingredients" id="ingredienti">

      <h2>Ingredienti
        <div class="sub">
          <span><%- page.recipeIntro[ 0 ] %></span>
          <span class="quantity">
            <button class="btn-icon btn-icon-minus"><svg class="icon"><use xlink:href="/images/svgdefs.svg#icon-minus"/></svg></button><span id="qtyValue"><%- page.recipeBase.qty %></span><% if ( page.recipeBase.units ) { %> <%- page.recipeBase.units %><% } %><button class="btn-icon btn-icon-plus"><svg class="icon"><use xlink:href="/images/svgdefs.svg#icon-plus"/></svg></button>
          </span>
          <span><%- page.recipeIntro[ 1 ] %></span>
        </div>
      </h2>

      <div class="card-list">
      <%

        var ingr = {},
          recipeBaseRatio = 1;

        if ( page.recipeBase.units === 'ml' && page.ingredients[ 0 ].units !== 'ml' ) {
          var ingrSpecRatios = 0;
          for ( i in page.ingredients ) {
            if ( page.ingredients[ i ].spec ) {
              ingrSpecRatios += +page.ingredients[ i ].ratio / +page.ingredients[ i ].spec;
            }
          }
          recipeBaseRatio = Math.round( ( 1 / ingrSpecRatios ) * 100000 ) / 1000;
        }

        for ( i = 0; i < page.ingredients.length; i++ ) {

          if ( page.ingredients[ i ].ratio ) {
            ingr[ page.ingredients[ i ].id ] = {
              ratio: +page.ingredients[ i ].ratio,
              spec: +page.ingredients[ i ].spec,
              units: page.ingredients[ i ].units
            };
          }

          if ( page.ingredients[ i ].name ) {

      %>
        <div class="card card-checkbox">
          <input type="checkbox" id="ingr<%= i %>">
          <label for="ingr<%= i %>"></label>
          <div class="card-body">
            <h3><span class="ingredient"><%- page.ingredients[ i ].name %></span><% if ( page.ingredients[ i ].qty ) { %><span class="quantity"><span data-qty="<%- page.ingredients[ i ].id %>"><%- page.ingredients[ i ].qty %></span> <%- page.ingredients[ i ].units %></span><% } %></h3>
            <% if ( page.ingredients[ i ].notes ) { %><p class="note"><%- page.ingredients[ i ].notes %></p><% } %>
          </div>
        </div><%
          }
        }
        if ( page.recipeDisclaimer ) { %>
        <div class="card-empty">
          <p><%- page.recipeDisclaimer %></p>
        </div>
      <% }
        page.qtyStep = ( page.recipeRange? page.recipeRange[ 2 ] : '50' ) + page.recipeBase.units;
      %>
        <script>var recipeBase=<%- JSON.stringify( page.recipeBase ) %>,recipeBaseRatio=<%- recipeBaseRatio %>,<% if ( page.recipeRange ) { %>recipeRange=[<%- page.recipeRange %>],<% } %><% if ( page.recipePrecision ) { %>recipePrecision=[<%- page.recipePrecision %>],<% } %>ingredients=<%- JSON.stringify( ingr ) %></script>
      </div>

    </section>

    <section class="content section3" id="attrezzatura">

      <h2>Attrezzatura</h2>

      <div class="card-list">
      <% for ( i = 0; i < page.tools.length; i++ ) { %>
        <div class="card card-checkbox">
          <input type="checkbox" id="tool<%= i %>">
          <label for="tool<%= i %>"></label>
          <div class="card-body">
          <h3><%- page.tools[ i ][ 0 ] %></h3>
          <% if ( page.tools[ i ][ 1 ] ) { %><p class="note"><%- page.tools[ i ][ 1 ] %></p><% } %>
          </div>
        </div>
      <% } %>
      </div>

    </section>

    <section class="content section4 section-instructions" id="ricetta">

      <h2><div class="sub"><span>Ricetta passo passo</span></div>Come fare <%- page.titleArticle %> <%- page.title.toLowerCase() %></h2>

      <div class="card-list card-list-ordered">
      <% for ( i = 0; i < page.directions.length; i++ ) { %>
        <div class="card<% if ( page.directions[ i ][ 2 ] ) { %> card-title<% } %>"><%
          if ( page.directions[ i ][ 2 ] ) { %>
            <h3><%- page.directions[ i ][ 2 ] %></h3><%
          } %>
          <p><%- page.directions[ i ][ 0 ] %></p>
          <% if ( page.directions[ i ][ 1 ] ) { %><p class="note"><%- page.directions[ i ][ 1 ] %></p><% } %>
        </div>
      <% } %>
      </div>

    </section>

    <section class="content section5 section-usage" id="uso">

      <div class="card-list">
        <div class="card">
          <h3>Come si usa</h3>
          <p><%- page.usage[ 0 ] %></p>
          <% if ( page.usage[ 1 ] ) { %><p class="note"><%- page.usage[ 1 ] %></p><% } %>
        </div>
        <div class="card">
          <h3>Come si conserva</h3>
          <p><%- page.storage[ 0 ] %></p>
          <% if ( page.storage[ 1 ] ) { %><p class="note"><%- page.storage[ 1 ] %></p><% } %>
        </div>
        <div class="card">
          <h3>Quanto dura</h3>
          <p><%- page.expiration[ 0 ] %></p>
          <% if ( page.expiration[ 1 ] ) { %><p class="note"><%- page.expiration[ 1 ] %></p><% } %>
        </div>
      </div>

    </section>

    <div class="recipefooter">
      <div class="content">
        <script>document.write('<a href="'+'znvygb:mra@mrabvq.vg'.encrypt()+'?subject=Ho un suggerimento per: <%- page.title %>" target="_blank" class="btn-icon" tabindex="-1"><svg class="icon"><use xlink:href="/images/svgdefs.svg#icon-mail"/></svg><span>Segnala errori o suggerimenti</span></a>');</script>
        <a href="https://github.com/zenoid/simpletomake/blob/master/source/recipes/<%- page.recipeid %>.md" target="_blank" class="btn-icon" tabindex="-1"><svg class="icon"><use xlink:href="/images/svgdefs.svg#icon-pr"/></svg><span>Proponi modifiche a questa ricetta su Github</span></a>
      </div>
    </div>

  </article>